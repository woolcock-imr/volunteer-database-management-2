<section>
    VmInclude:__COMPONENT__/grid/grid.v3.html
</section>
<script>
    function F__ID(){
        //-------------------------------------
        VmInclude:__COMPONENT__/grid/grid.v3.js
		_json='';
        //-------------------------------------
		$('#new__ID').hide();
		$('#save__ID').hide();
        /*
        Specs
        Only accessable for ADMIN
        Each project has a specific fixed search for volunteers.
        The search is based on information in 20009716 (project) - Search is done in 20008533 (volunteer).
        Select volunteers are added to 20009681 research-participation under relevant project
        1. Current Date must be within Start_Recruiting and End_Recruiting (20009716) (These fields are new and doesn't exist in the true database yet)
        2. Medical_Research (20008533) MUST BE CHECKED - exclude otherwise
        3. Postcode (20008533) - Min and max numeric value. Postcode_Min,Postcode_Max (20009716).
        4. Gender (20008533) - option Male, Female or Any (ignore gender) Gender (20009716)
        5. Year_of_Birth (20008533) Calculate Age based on current date - Min and Max numeric value. Age_Min,Age_Max (20009716)
        6. Diagnosis check boxes Asthma,COPD,Chronic_Bronchitis,Emphysema,Rhintis,Lung_Cancer,Insomnia,Narcolepsy,OSA,RLS (20008533)
        There are two sections for these checkboxes. If any of the criteria is not met the volunteer is excluded

        a. if any of these checkboxes are checked - the same correspondent checkboxes MUST be checked for the volunteer.
        Inc_Asthma,Inc_COPD,Inc_Emphysema,Inc_Lung_Cancer,Inc_Rhintis,Inc_Insomnia,Inc_Narcolepsy,Inc_OSA,Inc_RLS (20009716)
        eg.  Asthma,COPD,Rhintis are checked - Inc_Asthma is checked -> this volunteer is selected base on INCLUTION

        b. if any of these checkboxes are checked - the same correspondent checkboxes MUST NOT be checked for the volunteer.
        Exc_Asthma,Exc_COPD,Exc_Emphysema,Exc_Lung_Cancer,Exc_Rhintis,Exc_Insomnia,Exc_Narcolepsy,Exc_OSA,Exc_RLS (20009716)
        eg.  Asthma,COPD,Rhintis are checked - Exc_COPD is checked -> this volunteer is NOT selected base on EXCLUTION

        All Included Volunteers should be automatically be added to the project (research-participation 20009681) with a status "Search" - Status (20009681)
        If a volunteer already exisits in 20009681 the volunteer should not be added again. No records are ever deleted in 20009681. Only status change.

        If we alway query all projects at the same time - perhasp we can update a date DT3 for the volunteer (20008533) when we last did a search update.
        */
		//-------------------------------------
        _fields="Project_Name,_Search_for_new_Volunteers";
        _fields+=",Chief_Investigator,Contact_Name, Contact_Phone,Contact_Email";
		//-------------------------------------
		var prefix=$vm.module_list[$vm.vm['__ID'].name].prefix;
        //-------------------------------------
        _cell_render=function(records,I,field,td,set_value,source){
            records[I].vm_readonly[field]=true;
            switch(field){
                case '_Search_for_new_Volunteers':
                    records[I].vm_custom[field]=true;
                    if(records[I].UID==null || records[I].UID==undefined) return;
                    td.html("<u style='cursor:pointer;'>Search for new Volunteers...</u>");
                    td.find('u').on('click',function(){
						$vm.nav_load_module(prefix+'project-volunteers-search','',{record:records[I]});
                    })
                    break;
            }
        }
        //-------------------------------------
        $('#D__ID').on('load',function(){  _set_req(); _request_data();  })
        //-------------------------------------
		_set_req=function(){
			var sql="with pm as (select PS3=S3 from [TABLE-20011344] where S2=@S6)";
		    sql+=",tb as (select Information,ID,UID,PUID,DateTime,Author,RowNum=row_number() over (order by ID DESC) from [TABLE-"+_db_pid+"-@S1] join pm on PS3=S3)";
		    sql+="select Information,ID,UID,PUID,DateTime,Author,RowNum from tb where RowNum between @I6 and @I7";
		    var sql_n="select count(ID) from [TABLE-"+_db_pid+"-@S1]";
			_req={cmd:'query_records',db_pid:_db_pid,sql:sql,sql_n:sql_n,s1:'"'+$('#keyword__ID').val()+'"',I:$('#I__ID').text(),page_size:$('#page_size__ID').val()}
		}
		//-------------------------------------
    }
</script>
<style>
    VmInclude:__COMPONENT__/grid/grid.v3.css
</style>
